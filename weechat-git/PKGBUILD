pkgname=weechat-git
pkgver=1.3.31.rg4b2abd9
pkgrel=1

pkgdesc='Fast, light and extensible IRC client.'
url='http://www.weechat.org/'
arch=('i686' 'x86_64')
license=('GPL3')

depends=('ncurses-git' 'gnutls' 'libgcrypt' 'hicolor-icon-theme' 'gtk-update-icon-cache')
makedepends=('git' 'aspell' 'cmake' 'lua' 'perl' 'python' 'ruby' 'tcl')
# checkdepends=('cpputest')
optdepends=('aspell' 'lua' 'perl' 'python' 'ruby' 'tcl')

provides=('weechat')
conflicts=('weechat')

source=('git://github.com/weechat/weechat.git')

md5sums=('SKIP')

install='weechat-git.install'

pkgver() {
    cd weechat 
    git describe | sed 's/^v//; s/-/./; s/-/.r/; s/-/./'
}

build() {
    cd weechat
    cmake -DCMAKE_INSTALL_PREFIX=/usr \
        -DENABLE_PYTHON3=ON \
        -DCMAKE_BUILD_TYPE=Release \
        -DPYTHON_LIBRARY=/usr/lib/libpython3.4m.so \
        -DWEECHAT_HOME="${XDG_CONFIG_HOME:-$HOME/.config}"/weechat
}

# check() {
#     cd weechat/tests
#     cmake
#     make
#     ??? profit
# }

package() {
    cd weechat
    make DESTDIR="$pkgdir" install
}
